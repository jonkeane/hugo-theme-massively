<!-- reactive, resized and optimized backgrounds -->
{{ $bgimage := resources.Get "bg/IMG_4941.jpg" }}

<!-- >= 3:4 -->
{{ $2300x := $bgimage.Resize "2300x" }}
{{ $1680x := $bgimage.Resize "1680x" }}
{{ $1280x := $bgimage.Resize "1280x" }}
{{ $980x := $bgimage.Resize "980x" }}

<!-- < 3:4 -->
{{ $x2732 := $bgimage.Fill "2049x2732" }} <!-- 12inch ipad pro -->
{{ $x2388 := $bgimage.Fill "1791x2388" }} <!-- 10.5inch ipad pro -->
{{ $x2048 := $bgimage.Fill "1536x2048" }}
{{ $x1024 := $bgimage.Fill "768x1024" }}
{{ $x812 := $bgimage.Fill "609x812" }} <!-- iphone x -->
{{ $x667 := $bgimage.Fill "500x667" }} <!-- iphone 6/7/8 -->
{{ $x568 := $bgimage.Fill "426x568" }} <!-- iphone 5 -->

<!-- removing the gradient shifts the photo -->
{{ $overlayGradient := safeCSS "url('/images/overlay.png'), linear-gradient(0deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0))," }}

<style>
    /* <!-- default --> */

    @media screen {

        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $2300x.Permalink }}");
        }
    }

    /* <!-- orientation and covering --> */
    @media screen and (min-aspect-ratio: 1/1) {
        #wrapper > .bg {
    	    background-size: auto, auto, cover;
        }
    }

    @media screen and (max-aspect-ratio: 1/1) {
        #wrapper > .bg {
    	    background-size: auto, auto, auto 100%;
        }
    }


    /* <!-- >= 3:4 --> */
    /* <!-- todo: how to handle pixel ratios of 2 or 3? --> */
    @media screen and (max-width: 1680px) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $1680x.Permalink }}");
        }
    }

    @media screen and (max-width: 1280px) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $1280x.Permalink }}");
        }
    }

    @media screen and (max-width: 980px) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $980x.Permalink }}");
        }
    }

    @media screen and (max-width: 736px) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $980x.Permalink }}");
        }
    }

    @media screen and (max-width: 480px) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $980x.Permalink }}");
        }
    }

    @media screen and (max-width: 360px) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $980x.Permalink }}");
        }
    }




    /* <!-- < 3:4 using 7:8 here to catch devices that are 3:4, but have headers --> */

    @media screen and (max-height: 2732px) and (max-aspect-ratio: 7/8) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $x2732.Permalink }}");
        }
    }

    @media screen and (max-height: 2388px) and (max-aspect-ratio: 7/8) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $x2388.Permalink }}");
        }
    }

    @media screen and (max-height: 2048px) and (max-aspect-ratio: 7/8) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $x2048.Permalink }}");
        }
    }

    /* Temporarily disabled to make high pixel density devices still look ok
    @media screen and (max-height: 1024px) and (max-aspect-ratio: 7/8) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $x1024.Permalink }}");
        }
    }

    @media screen and (max-height: 812px) and (max-aspect-ratio: 7/8) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $x812.Permalink }}");
        }
    }

    @media screen and (max-height: 667px) and (max-aspect-ratio: 7/8) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $x667.Permalink }}");
        }
    }

    @media screen and (max-height: 568px) and (max-aspect-ratio: 7/8) {
        #wrapper > .bg {
    	    background-image: {{ $overlayGradient }} url("{{ $x568.Permalink }}");
        }
    }
    */

</style>