/* nanogallery2 - v3.0.5 - 2021-06-30 */
/**!
 * @preserve nanogallery2 - FLICKR data provider
 * Homepage: http://nanogallery2.nanostudio.org
 * Sources:  https://github.com/nanostudio-org/nanogallery2
 *
 * License:  GPLv3 and commercial licence
 *
*/
!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","nanogallery2"],t):"object"==typeof exports&&"function"==typeof require?t(require(["jquery","nanogallery2"])):t(jQuery)}((function(t){jQuery.nanogallery2.data_flickr=function(t,e){var r=t,l={url:function(){return"https://api.flickr.com/services/rest/"},thumbSize:"               sq",thumbAvailableSizes:new Array(75,100,150,240,500,640),thumbAvailableSizesStr:new Array("sq","t","q","s","m","z"),photoSize:"0",photoAvailableSizes:new Array(75,100,150,240,500,640,1024,1024,1600,2048,1e4),photoAvailableSizesStr:new Array("sq","t","q","s","m","z","b","l","h","k","o")},o=function(t,e,o,a){""==r.O.flickrAPIKey&&c(r,"Please set your Flickr API Key (option flickrAPIKey)");var n=NGY2Item.GetIdx(r,t),p="",m="image";"NONE"==r.O.photoset.toUpperCase()||"NONE"==r.O.album.toUpperCase()?p=l.url()+"?&method=flickr.people.getPublicPhotos&api_key="+r.O.flickrAPIKey+"&user_id="+r.O.userID+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_z,url_b,url_h,url_k&per_page=500&format=json":0==r.I[n].GetID()?(p=l.url()+"?&method=flickr.photosets.getList&api_key="+r.O.flickrAPIKey+"&user_id="+r.O.userID+"&per_page=500&primary_photo_extras=tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json",m="album"):p=l.url()+"?&method=flickr.photosets.getPhotos&api_key="+r.O.flickrAPIKey+"&photoset_id="+r.I[n].GetID()+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json",r.O.debugMode&&console.log("Flickr URL: "+p),h(!0),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;var d=setTimeout((function(){h(!1),c(r,"Could not retrieve AJAX data...")}),6e4),f=[],_=function(l,p){jQuery.getJSON(l+"&page="+p+"&jsoncallback=?",(function(v,b,x){var y=0;if("album"==m){if(void 0!==v.stat&&"fail"===v.stat)return c(r,"Could not retrieve Flickr album list: "+v.message+" (code: "+v.code+")."),!1;f=f.concat(v.photosets.photoset),y=v.photosets.pages}else if("NONE"==r.O.photoset.toUpperCase()||"NONE"==r.O.album.toUpperCase())f=f.concat(v.photos.photo),y=v.photos.pages;else{if(void 0!==v.stat&&"fail"===v.stat)return c(r,"Could not retrieve Flickr album: "+v.message+" (code: "+v.code+")."),!1;""==r.I[n].title&&(r.I[n].title=v.photoset.title),f=f.concat(v.photoset.photo),y=v.photoset.pages}y>p?_(l,p+1):(clearTimeout(d),h(!1),f=u(f,r.O.tagBlockList),"album"==m?s(n,t,f):i(n,t,f),g(t),null!=e&&e(o,a,null))})).fail((function(t,e,l){clearTimeout(d),h(!1),c(r,"Could not retrieve Flickr ajax data: "+e+", "+l)}))};_(p,1)};function i(t,e,o){r.O.debugMode&&(console.log("Flickr parse photos:"),console.dir(o)),jQuery.each(o,(function(t,o){var i=o.id,s=o.url_sq,n=o.title;""!=r.O.thumbnailLabel.get("title")&&(n=p(s));var u=o.description._content,h=75,m=75,g=l.photoAvailableSizesStr.length-1;r.O.flickrSkipOriginal&&g--;for(t=g;t>=0;t--)if(null!=o["url_"+l.photoAvailableSizesStr[t]]){s=o["url_"+l.photoAvailableSizesStr[t]],h=parseInt(o["width_"+l.photoAvailableSizesStr[t]]),m=parseInt(o["height_"+l.photoAvailableSizesStr[t]]);break}var d={};for(var f in o)0!=f.indexOf("height_")&&0!=f.indexOf("width_")&&0!=f.indexOf("url_")||(d[f]=o[f]);var _=void 0!==o.tags?o.tags:"",v=NGY2Item.New(r,n,u,i,e,"image",_);jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;var b=setTimeout((function(){c("Could not retrieve AJAX data...")}),1e3);url=l.url()+"?&method=flickr.photos.getExif&api_key="+r.O.flickrAPIKey+"&photo_id="+i+"&format=json",console.log(url),jQuery.getJSON(url+"&jsoncallback=?",(function(t,e,r){return console.log(t),v.exif.camera=t.photo.camera,clearTimeout(b),!0})).fail((function(t,e,r){console.log("error "+e),console.log("incoming Text "+t.responseText),console.log(r)})),v.setMediaURL(s,"img"),v.imageWidth=h,v.imageHeight=m;var x={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};x=a(x,o,"l1"),x=a(x,o,"lN"),v.thumbs=x;var y=r.O.fnProcessData;null!==y&&("function"==typeof y?y(v,"flickr",o):window[y](v,"flickr",o))})),r.I[t].contentIsLoaded=!0}function s(t,e,l){r.O.debugMode&&(console.log("Flickr parse list of albums:"),console.dir(l)),jQuery.each(l,(function(t,l){var o=l.title._content;if(0==l.visibility_can_see_set)return!0;if(m(o,l.id)){var i=l.id,s=null!=l.description._content?l.description._content:"",n={};for(var u in l.primary_photo_extras)n[u]=l.primary_photo_extras[u];var h="";void 0!==l.primary_photo_extras&&void 0!==l.primary_photo_extras.tags&&(h=l.primary_photo_extras.tags);var c=NGY2Item.New(r,o,s,i,e,"album",h);c.numberItems=l.photos,c.thumbSizes=n;var p={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};p=a(p,l.primary_photo_extras,"l1"),p=a(p,l.primary_photo_extras,"lN"),c.thumbs=p;var g=r.O.fnProcessData;null!==g&&("function"==typeof g?g(c,"flickr",l):window[g](c,"flickr",l))}})),r.I[t].contentIsLoaded=!0}function a(t,e,l){var o=1;!0===r.tn.opt[l].crop&&(o=r.O.thumbnailCropScaleFactor);for(var i=["xs","sm","me","la","xl"],s=0;s<i.length;s++)if("auto"==r.tn.settings.width[l][i[s]]||""==r.tn.settings.width[l][i[s]]){let a=n("height_",Math.ceil(r.tn.settings.height[l][i[s]]*r.tn.scale*o*r.tn.settings.mosaic[l+"Factor"].h[i[s]]),e);t.url[l][i[s]]=a.url,t.width[l][i[s]]=a.width,t.height[l][i[s]]=a.height}else if("auto"==r.tn.settings.height[l][i[s]]||""==r.tn.settings.height[l][i[s]]){let a=n("width_",Math.ceil(r.tn.settings.width[l][i[s]]*r.tn.scale*o*r.tn.settings.mosaic[l+"Factor"].w[i[s]]),e);t.url[l][i[s]]=a.url,t.width[l][i[s]]=a.width,t.height[l][i[s]]=a.height}else{let a="height_",u=Math.ceil(r.tn.settings.height[l][i[s]]*r.tn.scale*o*r.tn.settings.mosaic[l+"Factor"].h[i[s]]);r.tn.settings.width[l][i[s]]>r.tn.settings.height[l][i[s]]&&(a="width_",u=Math.ceil(r.tn.settings.width[l][i[s]]*r.tn.scale*o*r.tn.settings.mosaic[l+"Factor"].w[i[s]]));let h=n(a,u,e);t.url[l][i[s]]=h.url,t.width[l][i[s]]=h.width,t.height[l][i[s]]=h.height}return t}function n(t,e,r){for(var o={url:"",width:0,height:0},i=0,s=0;s<l.thumbAvailableSizes.length;s++){var a=r[t+l.photoAvailableSizesStr[s]];if(null!=a&&(i=s,a>=e))break}var n=l.photoAvailableSizesStr[i];return o.url=r["url_"+n],o.width=parseInt(r["width_"+n]),o.height=parseInt(r["height_"+n]),o}var u=function(t,e){return""!=e&&null!=t&&(t=t.filter((function(t){var r=new RegExp(e,"i"),l=[t.tags];return Array.isArray(t.tags)&&(l=t.tags),!l.some((function(t){return r.test(t)}))}))),t};var h=NGY2Tools.PreloaderDisplay.bind(r),c=NGY2Tools.NanoAlert,p=NGY2Tools.GetImageTitleFromURL.bind(r),m=NGY2Tools.FilterAlbumName.bind(r),g=NGY2Tools.AlbumPostProcess.bind(r);switch(e){case"AlbumGetContent":var d=arguments[2],f=arguments[3],_=arguments[4],v=arguments[5];o(d,f,_,v)}}}));