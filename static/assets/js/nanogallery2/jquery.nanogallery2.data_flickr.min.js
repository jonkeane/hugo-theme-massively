/* nanogallery2 - v3.0.5 - 2024-03-09 */
/**!
 * @preserve nanogallery2 - FLICKR data provider
 * Homepage: http://nanogallery2.nanostudio.org
 * Sources:  https://github.com/nanostudio-org/nanogallery2
 *
 * License:  GPLv3 and commercial licence
 * 
*/
!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","nanogallery2"],t):"object"==typeof exports&&"function"==typeof require?t(require(["jquery","nanogallery2"])):t(jQuery)}((function(t){jQuery.nanogallery2.data_flickr=function(t,e){var r=t,i={url:function(){return"https://api.flickr.com/services/rest/"},thumbSize:"               sq",thumbAvailableSizes:new Array(75,100,150,240,500,640),thumbAvailableSizesStr:new Array("sq","t","q","s","m","z"),photoSize:"0",photoAvailableSizes:new Array(75,100,150,240,500,640,1024,1024,1600,2048,1e4),photoAvailableSizesStr:new Array("sq","t","q","s","m","z","b","l","h","k","o")};function o(t,e){jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;var o=setTimeout((function(){u("Could not retrieve AJAX data...")}),6e4);url=i.url()+"?&method=flickr.photos.getExif&api_key="+r.O.flickrAPIKey+"&photo_id="+t+"&format=json",jQuery.getJSON(url+"&jsoncallback=?",(function(t,r,i){void 0!==t.photo.camera&&(e.exif.model=t.photo.camera);var l=t.photo.exif.filter((function(t){return"LensModel"==t.tag}));l.length>=1&&(e.exif.lens=l[0].raw._content);var a=t.photo.exif.filter((function(t){return"Flash"==t.tag}));a.length>=1&&(e.exif.flash=a[0].raw._content);var n=t.photo.exif.filter((function(t){return"FocalLength"==t.tag}));n.length>=1&&(e.exif.focallength=n[0].raw._content);var s=t.photo.exif.filter((function(t){return"FNumber"==t.tag}));s.length>=1&&(e.exif.fstop=s[0].raw._content);var u=t.photo.exif.filter((function(t){return"ExposureTime"==t.tag}));u.length>=1&&(e.exif.exposure=u[0].raw._content);var h=t.photo.exif.filter((function(t){return"ISO"==t.tag}));h.length>=1&&(e.exif.iso=h[0].raw._content);var c=t.photo.exif.filter((function(t){return"DateTimeOriginal"==t.tag}));c.length>=1&&(e.exif.time=c[0].raw._content);var f=t.photo.exif.filter((function(t){return"LOLcation"==t.tag}));f.length>=1&&(e.exif.location=f[0].raw._content);var p=t.photo.exif.filter((function(t){return"OwnerName"==t.tag}));p.length>=1&&(e.author=p[0].raw._content),clearTimeout(o)})).fail((function(t,e,r){console.log("Unable to get EXIF data from Flickr")}))}function l(t,e,i){var o=1;!0===r.tn.opt[i].crop&&(o=r.O.thumbnailCropScaleFactor);for(var l=["xs","sm","me","la","xl"],n=0;n<l.length;n++)if("auto"==r.tn.settings.width[i][l[n]]||""==r.tn.settings.width[i][l[n]]){let s=a("height_",Math.ceil(r.tn.settings.height[i][l[n]]*r.tn.scale*o*r.tn.settings.mosaic[i+"Factor"].h[l[n]]),e);t.url[i][l[n]]=s.url,t.width[i][l[n]]=s.width,t.height[i][l[n]]=s.height}else if("auto"==r.tn.settings.height[i][l[n]]||""==r.tn.settings.height[i][l[n]]){let s=a("width_",Math.ceil(r.tn.settings.width[i][l[n]]*r.tn.scale*o*r.tn.settings.mosaic[i+"Factor"].w[l[n]]),e);t.url[i][l[n]]=s.url,t.width[i][l[n]]=s.width,t.height[i][l[n]]=s.height}else{let s="height_",u=Math.ceil(r.tn.settings.height[i][l[n]]*r.tn.scale*o*r.tn.settings.mosaic[i+"Factor"].h[l[n]]);r.tn.settings.width[i][l[n]]>r.tn.settings.height[i][l[n]]&&(s="width_",u=Math.ceil(r.tn.settings.width[i][l[n]]*r.tn.scale*o*r.tn.settings.mosaic[i+"Factor"].w[l[n]]));let h=a(s,u,e);t.url[i][l[n]]=h.url,t.width[i][l[n]]=h.width,t.height[i][l[n]]=h.height}return t}function a(t,e,r){for(var o={url:"",width:0,height:0},l=0,a=0;a<i.thumbAvailableSizes.length;a++){var n=r[t+i.photoAvailableSizesStr[a]];if(null!=n&&(l=a,n>=e))break}var s=i.photoAvailableSizesStr[l];return o.url=r["url_"+s],o.width=parseInt(r["width_"+s]),o.height=parseInt(r["height_"+s]),o}var n=function(t,e){return""!=e&&null!=t&&(t=t.filter((function(t){var r=new RegExp(e,"i"),i=[t.tags];return Array.isArray(t.tags)&&(i=t.tags),!i.some((function(t){return r.test(t)}))}))),t};var s=NGY2Tools.PreloaderDisplay.bind(r),u=NGY2Tools.NanoAlert,h=NGY2Tools.GetImageTitleFromURL.bind(r),c=NGY2Tools.FilterAlbumName.bind(r),f=NGY2Tools.AlbumPostProcess.bind(r);"AlbumGetContent"===e&&function(t,e,a,p){""==r.O.flickrAPIKey&&u(r,"Please set your Flickr API Key (option flickrAPIKey)");var g=NGY2Item.GetIdx(r,t),m="",_="image";"NONE"==r.O.photoset.toUpperCase()||"NONE"==r.O.album.toUpperCase()?m=i.url()+"?&method=flickr.people.getPublicPhotos&api_key="+r.O.flickrAPIKey+"&user_id="+r.O.userID+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_z,url_b,url_h,url_k&per_page=500&format=json":0==r.I[g].GetID()?(m=i.url()+"?&method=flickr.photosets.getList&api_key="+r.O.flickrAPIKey+"&user_id="+r.O.userID+"&per_page=500&primary_photo_extras=tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json",_="album"):m=i.url()+"?&method=flickr.photosets.getPhotos&api_key="+r.O.flickrAPIKey+"&photoset_id="+r.I[g].GetID()+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json",r.O.debugMode&&console.log("Flickr URL: "+m),s(!0),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;var d=setTimeout((function(){s(!1),u(r,"Could not retrieve AJAX data...")}),6e4),x=[],v=function(){clearTimeout(d),s(!1),x=n(x,r.O.tagBlockList),"album"==_?function(t,e,i){r.O.debugMode&&(console.log("Flickr parse list of albums:"),console.dir(i)),jQuery.each(i,(function(t,i){var o=i.title._content;if(0==i.visibility_can_see_set)return!0;if(c(o,i.id)){var a=i.id,n=null!=i.description._content?i.description._content:"",s={};for(var u in i.primary_photo_extras)s[u]=i.primary_photo_extras[u];var h="";void 0!==i.primary_photo_extras&&void 0!==i.primary_photo_extras.tags&&(h=i.primary_photo_extras.tags);var f=NGY2Item.New(r,o,n,a,e,"album",h);f.numberItems=i.photos,f.thumbSizes=s;var p={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};p=l(p,i.primary_photo_extras,"l1"),p=l(p,i.primary_photo_extras,"lN"),f.thumbs=p;var g=r.O.fnProcessData;null!==g&&("function"==typeof g?g(f,"flickr",i):window[g](f,"flickr",i))}})),r.I[t].contentIsLoaded=!0}(g,t,x):function(t,e,a){r.O.debugMode&&(console.log("Flickr parse photos:"),console.dir(a)),jQuery.each(a,(function(t,a){var n=a.id,s=a.url_sq,u=a.title;""!=r.O.thumbnailLabel.get("title")&&(u=h(s));var c=a.description._content,f=75,p=75,g=i.photoAvailableSizesStr.length-1;for(r.O.flickrSkipOriginal&&g--,t=g;t>=0;t--)if(null!=a["url_"+i.photoAvailableSizesStr[t]]){s=a["url_"+i.photoAvailableSizesStr[t]],f=parseInt(a["width_"+i.photoAvailableSizesStr[t]]),p=parseInt(a["height_"+i.photoAvailableSizesStr[t]]);break}var m={};for(var _ in a)0!=_.indexOf("height_")&&0!=_.indexOf("width_")&&0!=_.indexOf("url_")||(m[_]=a[_]);var d=void 0!==a.tags?a.tags:"",x=NGY2Item.New(r,u,c,n,e,"image",d);r.O.flickrExif&&o(n,x),x.setMediaURL(s,"img"),x.imageWidth=f,x.imageHeight=p;var v={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};v=l(v,a,"l1"),v=l(v,a,"lN"),x.thumbs=v;var b=r.O.fnProcessData;null!==b&&("function"==typeof b?b(x,"flickr",a):window[b](x,"flickr",a))})),r.I[t].contentIsLoaded=!0}(g,t,x),f(t),null!=e&&e(a,p,null)},b=function(t,e){jQuery.getJSON(t+"&page="+e+"&jsoncallback=?",(function(i,o,l){var a=0;if("album"==_){if(void 0!==i.stat&&"fail"===i.stat)return u(r,"Could not retrieve Flickr album list: "+i.message+" (code: "+i.code+")."),!1;x=x.concat(i.photosets.photoset),a=i.photosets.pages}else if("NONE"==r.O.photoset.toUpperCase()||"NONE"==r.O.album.toUpperCase())x=x.concat(i.photos.photo),a=i.photos.pages;else{if(void 0!==i.stat&&"fail"===i.stat)return u(r,"Could not retrieve Flickr album: "+i.message+" (code: "+i.code+")."),!1;""==r.I[g].title&&(r.I[g].title=i.photoset.title),x=x.concat(i.photoset.photo),a=i.photoset.pages}a>e?b(t,e+1):v()})).fail((function(t,e,i){clearTimeout(d),s(!1),u(r,"Could not retrieve Flickr ajax data: "+e+", "+i)}))};b(m,1)}(arguments[2],arguments[3],arguments[4],arguments[5])}}));