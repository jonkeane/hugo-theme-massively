/* nanogallery2 - v3.0.5 - 2024-03-14 */
/**!
 * @preserve nanogallery2 - FLICKR data provider
 * Homepage: http://nanogallery2.nanostudio.org
 * Sources:  https://github.com/nanostudio-org/nanogallery2
 *
 * License:  GPLv3 and commercial licence
 * 
*/
!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","nanogallery2"],t):"object"==typeof exports&&"function"==typeof require?t(require(["jquery","nanogallery2"])):t(jQuery)}((function(t){jQuery.nanogallery2.data_flickr=function(t,e){var r=t,i={url:function(){return"https://api.flickr.com/services/rest/"},thumbSize:"               sq",thumbAvailableSizes:new Array(75,100,150,240,500,640),thumbAvailableSizesStr:new Array("sq","t","q","s","m","z"),photoSize:"0",photoAvailableSizes:new Array(75,100,150,240,500,640,1024,1024,1600,2048,1e4),photoAvailableSizesStr:new Array("sq","t","q","s","m","z","b","l","h","k","o")};function l(t,e,i){var l=1;!0===r.tn.opt[i].crop&&(l=r.O.thumbnailCropScaleFactor);for(var s=["xs","sm","me","la","xl"],a=0;a<s.length;a++)if("auto"==r.tn.settings.width[i][s[a]]||""==r.tn.settings.width[i][s[a]]){let n=o("height_",Math.ceil(r.tn.settings.height[i][s[a]]*r.tn.scale*l*r.tn.settings.mosaic[i+"Factor"].h[s[a]]),e);t.url[i][s[a]]=n.url,t.width[i][s[a]]=n.width,t.height[i][s[a]]=n.height}else if("auto"==r.tn.settings.height[i][s[a]]||""==r.tn.settings.height[i][s[a]]){let n=o("width_",Math.ceil(r.tn.settings.width[i][s[a]]*r.tn.scale*l*r.tn.settings.mosaic[i+"Factor"].w[s[a]]),e);t.url[i][s[a]]=n.url,t.width[i][s[a]]=n.width,t.height[i][s[a]]=n.height}else{let n="height_",u=Math.ceil(r.tn.settings.height[i][s[a]]*r.tn.scale*l*r.tn.settings.mosaic[i+"Factor"].h[s[a]]);r.tn.settings.width[i][s[a]]>r.tn.settings.height[i][s[a]]&&(n="width_",u=Math.ceil(r.tn.settings.width[i][s[a]]*r.tn.scale*l*r.tn.settings.mosaic[i+"Factor"].w[s[a]]));let h=o(n,u,e);t.url[i][s[a]]=h.url,t.width[i][s[a]]=h.width,t.height[i][s[a]]=h.height}return t}function o(t,e,r){for(var l={url:"",width:0,height:0},o=0,s=0;s<i.thumbAvailableSizes.length;s++){var a=r[t+i.photoAvailableSizesStr[s]];if(null!=a&&(o=s,a>=e))break}var n=i.photoAvailableSizesStr[o];return l.url=r["url_"+n],l.width=parseInt(r["width_"+n]),l.height=parseInt(r["height_"+n]),l}var s=function(t,e){return""!=e&&null!=t&&(t=t.filter((function(t){var r=new RegExp(e,"i"),i=[t.tags];return Array.isArray(t.tags)&&(i=t.tags),!i.some((function(t){return r.test(t)}))}))),t};var a=NGY2Tools.PreloaderDisplay.bind(r),n=NGY2Tools.NanoAlert,u=NGY2Tools.GetImageTitleFromURL.bind(r),h=NGY2Tools.FilterAlbumName.bind(r),c=NGY2Tools.AlbumPostProcess.bind(r);"AlbumGetContent"===e&&function(t,e,o,p){""==r.O.flickrAPIKey&&n(r,"Please set your Flickr API Key (option flickrAPIKey)");var m=NGY2Item.GetIdx(r,t),_="",d="image";"NONE"==r.O.photoset.toUpperCase()||"NONE"==r.O.album.toUpperCase()?_=i.url()+"?&method=flickr.people.getPublicPhotos&api_key="+r.O.flickrAPIKey+"&user_id="+r.O.userID+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_z,url_b,url_h,url_k&per_page=500&format=json":0==r.I[m].GetID()?(_=i.url()+"?&method=flickr.photosets.getList&api_key="+r.O.flickrAPIKey+"&user_id="+r.O.userID+"&per_page=500&primary_photo_extras=tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json",d="album"):_=i.url()+"?&method=flickr.photosets.getPhotos&api_key="+r.O.flickrAPIKey+"&photoset_id="+r.I[m].GetID()+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json",r.O.debugMode&&console.log("Flickr URL: "+_),a(!0),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;var g=setTimeout((function(){a(!1),n(r,"Could not retrieve AJAX data...")}),6e4),f=[],b=function(){clearTimeout(g),a(!1),f=s(f,r.O.tagBlockList),"album"==d?function(t,e,i){r.O.debugMode&&(console.log("Flickr parse list of albums:"),console.dir(i)),jQuery.each(i,(function(t,i){var o=i.title._content;if(0==i.visibility_can_see_set)return!0;if(h(o,i.id)){var s=i.id,a=null!=i.description._content?i.description._content:"",n={};for(var u in i.primary_photo_extras)n[u]=i.primary_photo_extras[u];var c="";void 0!==i.primary_photo_extras&&void 0!==i.primary_photo_extras.tags&&(c=i.primary_photo_extras.tags);var p=NGY2Item.New(r,o,a,s,e,"album",c);p.numberItems=i.photos,p.thumbSizes=n;var m={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};m=l(m,i.primary_photo_extras,"l1"),m=l(m,i.primary_photo_extras,"lN"),p.thumbs=m;var _=r.O.fnProcessData;null!==_&&("function"==typeof _?_(p,"flickr",i):window[_](p,"flickr",i))}})),r.I[t].contentIsLoaded=!0}(m,t,f):function(t,e,o){r.O.debugMode&&(console.log("Flickr parse photos:"),console.dir(o)),jQuery.each(o,(function(t,o){var s=o.id,a=o.url_sq,n=o.title;""!=r.O.thumbnailLabel.get("title")&&(n=u(a));var h=o.description._content,c=75,p=75,m=i.photoAvailableSizesStr.length-1;for(r.O.flickrSkipOriginal&&m--,t=m;t>=0;t--)if(null!=o["url_"+i.photoAvailableSizesStr[t]]){a=o["url_"+i.photoAvailableSizesStr[t]],c=parseInt(o["width_"+i.photoAvailableSizesStr[t]]),p=parseInt(o["height_"+i.photoAvailableSizesStr[t]]);break}var _={};for(var d in o)0!=d.indexOf("height_")&&0!=d.indexOf("width_")&&0!=d.indexOf("url_")||(_[d]=o[d]);var g=void 0!==o.tags?o.tags:"",f=NGY2Item.New(r,n,h,s,e,"image",g);f.setMediaURL(a,"img"),f.imageWidth=c,f.imageHeight=p,f.static_photo=a.replace("https://live.staticflickr.com/","");var b={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};b=l(b,o,"l1"),b=l(b,o,"lN"),f.thumbs=b;var v=r.O.fnProcessData;null!==v&&("function"==typeof v?v(f,"flickr",o):window[v](f,"flickr",o))})),r.I[t].contentIsLoaded=!0}(m,t,f),c(t),null!=e&&e(o,p,null)},v=function(t,e){jQuery.getJSON(t+"&page="+e+"&jsoncallback=?",(function(i,l,o){var s=0;if("album"==d){if(void 0!==i.stat&&"fail"===i.stat)return n(r,"Could not retrieve Flickr album list: "+i.message+" (code: "+i.code+")."),!1;f=f.concat(i.photosets.photoset),s=i.photosets.pages}else if("NONE"==r.O.photoset.toUpperCase()||"NONE"==r.O.album.toUpperCase())f=f.concat(i.photos.photo),s=i.photos.pages;else{if(void 0!==i.stat&&"fail"===i.stat)return n(r,"Could not retrieve Flickr album: "+i.message+" (code: "+i.code+")."),!1;""==r.I[m].title&&(r.I[m].title=i.photoset.title),f=f.concat(i.photoset.photo),s=i.photoset.pages}s>e?v(t,e+1):b()})).fail((function(t,e,i){clearTimeout(g),a(!1),n(r,"Could not retrieve Flickr ajax data: "+e+", "+i)}))};v(_,1)}(arguments[2],arguments[3],arguments[4],arguments[5])}}));